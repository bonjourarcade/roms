<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BonjourArcade - Jeux √† venir</title>
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="">
    <meta property="og:title" content="BonjourArcade - Jeux √† venir">
    <meta property="og:description" content="D√©couvrez les prochains jeux de la semaine sur BonjourArcade">
    <meta property="og:image" content="">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="">
    <meta property="twitter:title" content="BonjourArcade - Jeux √† venir">
    <meta property="twitter:description" content="D√©couvrez les prochains jeux de la semaine sur BonjourArcade">
    <meta property="twitter:image" content="">
    
    <link rel="stylesheet" href="../assets/css/style.css">
    <style>
        .upcoming-games-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .upcoming-games-title {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5rem;
            color: #333;
        }
        
        .upcoming-games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .upcoming-game-card {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid #e0e0e0;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            cursor: pointer;
        }
        
        .upcoming-game-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
        }
        
        .upcoming-game-image {
            text-align: center;
            margin-bottom: 15px;
        }
        
        .upcoming-game-image img {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .upcoming-game-info {
            margin: 10px 0;
            font-size: 0.9rem;
            color: #666;
        }
        
        .upcoming-game-info span {
            display: inline-block;
            margin-right: 8px;
            padding: 2px 6px;
            background: #f0f0f0;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .upcoming-game-info .developer {
            background: #e3f2fd;
            color: #1976d2;
        }
        
        .upcoming-game-info .year {
            background: #f3e5f5;
            color: #7b1fa2;
        }
        
        .upcoming-game-info .genre {
            background: #e8f5e8;
            color: #388e3c;
        }
        
        .upcoming-game-leaderboard {
            margin: 15px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }
        
        .leaderboard-title {
            font-size: 0.85rem;
            font-weight: bold;
            color: #495057;
            margin-bottom: 8px;
            text-align: center;
        }
        
        .leaderboard-entry {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 0;
            font-size: 0.8rem;
        }
        
        .leaderboard-rank {
            font-size: 0.9rem;
            margin-right: 6px;
        }
        
        .leaderboard-player {
            flex: 1;
            color: #495057;
            font-weight: 500;
        }
        
        .leaderboard-score {
            color: #28a745;
            font-weight: bold;
            font-family: monospace;
        }
        
        .leaderboard-loading {
            text-align: center;
            color: #6c757d;
            font-size: 0.8rem;
            font-style: italic;
        }
        
        .leaderboard-empty {
            text-align: center;
            color: #6c757d;
            font-size: 0.8rem;
            font-style: italic;
        }
        
        .leaderboard-error {
            text-align: center;
            color: #dc3545;
            font-size: 0.8rem;
        }
        
        .upcoming-game-week {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .upcoming-game-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        
        .upcoming-game-id {
            font-size: 0.9rem;
            color: #888;
            font-family: monospace;
            background: #f5f5f5;
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
        }
        
        .back-to-home {
            text-align: center;
            margin-top: 40px;
        }
        
        .back-to-home a {
            display: inline-block;
            padding: 12px 24px;
            background: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 500;
            transition: background 0.2s ease;
        }
        
        .back-to-home a:hover {
            background: #0056b3;
        }
        
        .loading-message {
            text-align: center;
            font-size: 1.2rem;
            color: #666;
            margin: 40px 0;
        }
        
        .error-message {
            text-align: center;
            color: #dc3545;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        /* Dark theme support */
        .theme-dark .upcoming-games-title {
            color: #fff;
        }
        
        .theme-dark .upcoming-game-card {
            background: #2d2d2d;
            border-color: #444;
        }
        
        .theme-dark .upcoming-game-title {
            color: #fff;
        }
        
        .theme-dark .upcoming-game-week {
            color: #ccc;
        }
        
        .theme-dark .upcoming-game-id {
            background: #444;
            color: #ccc;
        }
        
        .theme-dark .loading-message {
            color: #ccc;
        }
        
        .theme-dark .error-message {
            background: #4a1a1a;
            border-color: #6b2c2c;
            color: #f8d7da;
        }
        
        .theme-dark .upcoming-game-info span {
            background: #444;
            color: #ccc;
        }
        
        .theme-dark .upcoming-game-info .developer {
            background: #1a237e;
            color: #90caf9;
        }
        
        .theme-dark .upcoming-game-info .year {
            background: #4a148c;
            color: #ce93d8;
        }
        
        .theme-dark .upcoming-game-info .genre {
            background: #1b5e20;
            color: #a5d6a7;
        }
        
        .theme-dark .upcoming-game-leaderboard {
            background: #3d3d3d;
            border-color: #555;
        }
        
        .theme-dark .leaderboard-title {
            color: #e0e0e0;
        }
        
        .theme-dark .leaderboard-player {
            color: #e0e0e0;
        }
        
        .theme-dark .leaderboard-score {
            color: #4caf50;
        }
        
        .theme-dark .leaderboard-loading,
        .theme-dark .leaderboard-empty {
            color: #aaa;
        }
        
        .theme-dark .leaderboard-error {
            color: #f44336;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-flex">
                <button id="random-game-btn" class="random-game-btn">üé≤ Jouer au hasard</button>
                <!-- Home button removed: logo will link to home -->
                <button id="newsletter-subscribe" class="newsletter-btn">üìß S'abonner au jeu de la semaine</button>
                <div class="game-launcher">
                    <input type="text" id="game-id-input" placeholder="Recherche">
                </div>
                <a href="/" aria-label="Retour √† l'accueil">
                    <img src="../assets/images/bonjourarcade-logo.png" alt="BonjourArcade Logo" class="header-logo">
                </a>
                <div class="header-actions">
                    <a target="_blank" id="leaderboard-link" href="https://alloarcade.web.app">Classements</a>
                    <img src="../assets/images/my_app_qr.png" alt="QR Code" class="static-qr-code">
                </div>
                <div style="position: relative;">
                    <button id="theme-toggle-btn" class="theme-btn" aria-label="Changer le th√®me" type="button">
                        <span id="theme-toggle-icon" style="display:inline-flex;align-items:center;font-size:1.2em;">üåì</span>
                        <span id="theme-toggle-label">Th√®me</span>
                    </button>
                    <div id="theme-dropdown" style="display:none;position:absolute;top:110%;left:50%;transform:translateX(-50%);background:#222;color:#fff;border:1px solid #444;border-radius:8px;box-shadow:0 4px 16px #0002;min-width:170px;z-index:10000;padding:8px 0;">
                        <button class="theme-option" data-theme="system" style="display:flex;align-items:center;width:100%;background:none;border:none;color:inherit;font:inherit;padding:8px 18px;gap:10px;cursor:pointer;"><span style='font-size:1.2em;'>üåì</span>Syst√®me</button>
                        <button class="theme-option" data-theme="light" style="display:flex;align-items:center;width:100%;background:none;border:none;color:inherit;font:inherit;padding:8px 18px;gap:10px;cursor:pointer;"><span style='font-size:1.2em;'>‚òÄÔ∏è</span>Clair</button>
                        <button class="theme-option" data-theme="dark" style="display:flex;align-items:center;width:100%;background:none;border:none;color:inherit;font:inherit;padding:8px 18px;gap:10px;cursor:pointer;"><span style='font-size:1.2em;'>üåô</span>Sombre</button>
                    </div>
                </div>
            </div>
        </header>

        <main class="main-content">
            <div class="upcoming-games-container">
                <h1 class="upcoming-games-title">üéÆ Jeux √† venir</h1>
                
                <div id="loading-message" class="loading-message">
                    Chargement des jeux √† venir...
                </div>
                
                <div id="error-message" class="error-message" style="display: none;">
                    Erreur lors du chargement des jeux √† venir. Veuillez r√©essayer plus tard.
                </div>
                
                <div id="upcoming-games-grid" class="upcoming-games-grid" style="display: none;">
                    <!-- Les jeux seront charg√©s ici par JavaScript -->
                </div>
                
                <div class="back-to-home">
                    <a href="/" aria-label="Retour √† l'accueil">‚Üê Retour √† l'accueil</a>
                </div>
            </div>
        </main>
    </div>

    <script src="../assets/js/utils.js"></script>
    <script>
        // Theme toggling logic (copied from main page)
        function setTheme(theme) {
            document.body.classList.remove('theme-light', 'theme-dark');
            let classToAdd;
            if (theme === 'system') {
                classToAdd = getSystemTheme();
            } else if (theme === 'dark') {
                classToAdd = 'theme-dark';
            } else {
                classToAdd = 'theme-light';
            }
            document.body.classList.add(classToAdd);
            
            // Update button icon and label
            const icon = document.getElementById('theme-toggle-icon');
            const label = document.getElementById('theme-toggle-label');
            if (icon && label) {
                if (theme === 'dark') {
                    icon.textContent = 'üåô';
                    label.textContent = 'Sombre';
                } else if (theme === 'light') {
                    icon.textContent = '‚òÄÔ∏è';
                    label.textContent = 'Clair';
                } else {
                    icon.textContent = 'üåì';
                    label.textContent = 'Th√®me';
                }
            }
            
            // Highlight current in dropdown
            document.querySelectorAll('.theme-option').forEach(btn => {
                btn.style.background = (btn.dataset.theme === theme) ? '#444' : 'none';
            });
            
            // Update button style for dark/light
            const themeBtn = document.getElementById('theme-toggle-btn');
            if (themeBtn) {
                if (classToAdd === 'theme-dark') {
                    themeBtn.style.background = '#222';
                    themeBtn.style.color = '#fff';
                    themeBtn.style.border = '1px solid #fff2';
                } else {
                    themeBtn.style.background = '#fff';
                    themeBtn.style.color = '#111';
                    themeBtn.style.border = '1px solid #ccc';
                }
            }
        }

        function getSystemTheme() {
            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'theme-dark' : 'theme-light';
        }

        // Dropdown logic
        const themeBtn = document.getElementById('theme-toggle-btn');
        const themeDropdown = document.getElementById('theme-dropdown');
        themeBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            themeDropdown.style.display = (themeDropdown.style.display === 'block') ? 'none' : 'block';
        });
        document.addEventListener('click', function(e) {
            if (themeDropdown.style.display === 'block') themeDropdown.style.display = 'none';
        });
        themeDropdown.addEventListener('click', function(e) { e.stopPropagation(); });
        document.querySelectorAll('.theme-option').forEach(btn => {
            btn.addEventListener('click', function() {
                const selected = btn.dataset.theme;
                if (selected === 'system') {
                    localStorage.removeItem('theme');
                } else {
                    localStorage.setItem('theme', selected);
                }
                setTheme(selected);
                themeDropdown.style.display = 'none';
            });
        });

        // On load: use localStorage or system preference
        const savedTheme = localStorage.getItem('theme');
        const initialTheme = savedTheme || 'system';
        setTheme(initialTheme);
        
        // Listen for system theme changes if user hasn't chosen
        if (!savedTheme) {
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
                setTheme('system');
            });
        }

        // Load upcoming games
        async function loadUpcomingGames() {
            try {
                // Load both predictions and game data
                const [predictionsResponse, gamesResponse] = await Promise.all([
                    fetch('../plinko/predict/predictions.yaml'),
                    fetch('../gamelist.json')
                ]);
                
                if (!predictionsResponse.ok || !gamesResponse.ok) {
                    throw new Error('Failed to fetch data');
                }
                
                const yamlText = await predictionsResponse.text();
                const gamesData = await gamesResponse.json();
                
                const predictions = parseYamlPredictions(yamlText);
                const enrichedGames = enrichPredictionsWithGameData(predictions, gamesData.games);
                
                displayUpcomingGames(enrichedGames);
            } catch (error) {
                console.error('Error loading upcoming games:', error);
                showError();
            }
        }

        function parseYamlPredictions(yamlText) {
            const games = [];
            const lines = yamlText.split('\n');
            
            let currentWeek = null;
            let currentGame = {};
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                // Skip comments and empty lines
                if (line.startsWith('#') || line === '') {
                    continue;
                }
                
                // Check if line is a week number (YYYYWW format)
                if (/^\d{6}:$/.test(line)) {
                    // Save previous game if exists. Include entries that at least have a game_id;
                    // title may be missing in predictions.yaml and will be filled from gamelist.json later.
                    if (currentWeek && currentGame.game_id) {
                        games.push({
                            week: currentWeek,
                            title: currentGame.title || null,
                            game_id: currentGame.game_id
                        });
                    }
                    
                    // Start new week
                    currentWeek = line.replace(':', '');
                    currentGame = {};
                } else if (line.startsWith('title:')) {
                    currentGame.title = line.replace('title:', '').trim().replace(/^["']|["']$/g, '');
                } else if (line.startsWith('game_id:')) {
                    currentGame.game_id = line.replace('game_id:', '').trim().replace(/^["']|["']$/g, '');
                }
            }
            
            // Don't forget the last game - include if game_id is present
            if (currentWeek && currentGame.game_id) {
                games.push({
                    week: currentWeek,
                    title: currentGame.title || null,
                    game_id: currentGame.game_id
                });
            }
            
            // Filter out past games
            return filterFutureGames(games);
        }

        function enrichPredictionsWithGameData(predictions, gamesData) {
            return predictions.map(prediction => {
                // Find matching game data
                const gameData = gamesData.find(game => game.id === prediction.game_id);
                
                if (gameData) {
                    return {
                        ...prediction,
                        title: gameData.title || prediction.title,
                        coverArt: gameData.coverArt,
                        pageUrl: gameData.pageUrl || `/play?game=${prediction.game_id}`,
                        developer: gameData.developer,
                        year: gameData.year,
                        genre: gameData.genre,
                        enable_score: gameData.enable_score
                    };
                } else {
                    // Fallback if game data not found
                    return {
                        ...prediction,
                        coverArt: '/assets/images/placeholder_thumb.png',
                        pageUrl: `/play?game=${prediction.game_id}`,
                        developer: '',
                        year: '',
                        genre: '',
                        enable_score: true
                    };
                }
            });
        }

        async function fetchLeaderboardData(gameId) {
            try {
                // Check if we're on localhost and use mock data
                const isLocalhost = window.location.hostname === 'localhost' || 
                                  window.location.hostname === '127.0.0.1' || 
                                  window.location.hostname.includes('localhost');
                
                let data;
                
                if (isLocalhost) {
                    // Use mock data for localhost
                    data = {
                        result: {
                            success: true,
                            scores: generateMockScores(gameId)
                        }
                    };
                } else {
                    console.log('[leaderboard] fetching scores for', gameId, 'from alloarcade');
                    const response = await fetch('https://us-central1-alloarcade.cloudfunctions.net/listGameScores', {
                        method: 'POST',
                        headers: {
                            'accept': '*/*',
                            'content-type': 'application/json',
                            'origin': 'https://alloarcade.web.app',
                            'referer': 'https://alloarcade.web.app/',
                        },
                        body: JSON.stringify({
                            data: {
                                timeRange: "all",
                                gameId: gameId
                            }
                        })
                    });

                    console.log('[leaderboard] response status for', gameId, response.status, response.statusText);
                    if (!response.ok) {
                        // Try to get response text for debugging
                        let respText = '';
                        try { respText = await response.text(); } catch (e) { /* ignore */ }
                        console.error('[leaderboard] non-ok response:', response.status, respText);
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    try {
                        data = await response.json();
                        console.log('[leaderboard] got data for', gameId, data && data.result && data.result.success);
                    } catch (e) {
                        console.error('[leaderboard] failed to parse JSON for', gameId, e);
                        throw e;
                    }
                }
                
                if (!data.result || !data.result.success || !data.result.scores) {
                    return null;
                }

                // Get best score for each unique player
                const playerBestScores = new Map();
                
                data.result.scores.forEach(score => {
                    const userId = score.userId;
                    const currentBest = playerBestScores.get(userId);
                    
                    if (!currentBest || score.score > currentBest.score) {
                        playerBestScores.set(userId, {
                            player: score.player,
                            score: score.score,
                            rank: score.rank
                        });
                    }
                });

                // Convert to array and sort by score (highest first)
                const sortedScores = Array.from(playerBestScores.values())
                    .sort((a, b) => b.score - a.score)
                    .slice(0, 3); // Show top 3 players for upcoming page

                return sortedScores;
            } catch (error) {
                console.error('Error fetching leaderboard for', gameId, ':', error);
                return null;
            }
        }

        function generateMockScores(gameId) {
            const mockPlayers = [
                { name: "F√©lix L", userId: "user1" },
                { name: "Marie C", userId: "user2" },
                { name: "Jean P", userId: "user3" },
                { name: "Sophie M", userId: "user4" },
                { name: "Pierre D", userId: "user5" }
            ];

            // Generate different score ranges based on game type
            let baseScore = 1000;
            if (gameId.includes('shmup') || gameId.includes('shoot')) {
                baseScore = 50000;
            } else if (gameId.includes('puzzle')) {
                baseScore = 5000;
            } else if (gameId.includes('platform')) {
                baseScore = 15000;
            }

            return mockPlayers.map((player, index) => ({
                rank: index + 1,
                id: `mock_${player.userId}_${Date.now()}`,
                userId: player.userId,
                player: player.name,
                photoURL: `https://via.placeholder.com/96/cccccc/666666?text=${player.name.charAt(0)}`,
                score: Math.floor(baseScore * (1 + Math.random() * 5) * (1 - index * 0.1)),
                game: gameId,
                date: {
                    _seconds: Math.floor(Date.now() / 1000) - Math.floor(Math.random() * 86400 * 30),
                    _nanoseconds: Math.floor(Math.random() * 1000000000)
                },
                verified: true,
                screenshotUrl: `https://via.placeholder.com/300x200/333333/ffffff?text=Screenshot`
            }));
        }

        function getCurrentWeek() {
            const now = new Date();
            const year = now.getFullYear();
            
            // Calculate ISO week number
            const target = new Date(now.valueOf());
            const dayNr = (now.getDay() + 6) % 7;
            target.setDate(target.getDate() - dayNr + 3);
            const firstThursday = target.valueOf();
            target.setMonth(0, 1);
            if (target.getDay() !== 4) {
                target.setMonth(0, 1 + ((4 - target.getDay()) + 7) % 7);
            }
            const weekNumber = 1 + Math.ceil((firstThursday - target) / 604800000);
            
            // Format as YYYYWW
            return year.toString() + weekNumber.toString().padStart(2, '0');
        }

        function filterFutureGames(games) {
            const currentWeek = getCurrentWeek();
            
            return games.filter(game => {
                // Compare week strings (YYYYWW format)
                // Convert to numbers for proper comparison
                const gameWeekNum = parseInt(game.week);
                const currentWeekNum = parseInt(currentWeek);
                // Exclude the current week so upcoming starts after this week
                return gameWeekNum > currentWeekNum;
            });
        }

        async function displayUpcomingGames(games) {
            const loadingMessage = document.getElementById('loading-message');
            const gamesGrid = document.getElementById('upcoming-games-grid');
            
            loadingMessage.style.display = 'none';
            
            if (games.length === 0) {
                gamesGrid.style.display = 'block';
                gamesGrid.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <h3>üéÆ Aucun jeu √† venir</h3>
                        <p>Il n'y a actuellement aucun jeu pr√©vu pour les prochaines semaines.</p>
                        <p>Revenez plus tard pour d√©couvrir les nouveaux jeux !</p>
                    </div>
                `;
            } else {
                gamesGrid.style.display = 'grid';
                
                // Display games first, then load leaderboards
                gamesGrid.innerHTML = games.map(game => {
                    const weekFormatted = formatWeek(game.week);
                    const coverSrc = getThumbnailSrc(game.coverArt);
                    const gameInfo = getGameInfo(game);
                    
                    return `
                        <div class="upcoming-game-card" onclick="handleGameClick(this)" data-game-id="${game.game_id}">
                            <a href="${game.pageUrl}" style="text-decoration: none; color: inherit;">
                                <div class="upcoming-game-image">
                                    <img src="${coverSrc}" alt="${game.title}" loading="lazy">
                                </div>
                                <div class="upcoming-game-week">Semaine ${weekFormatted}</div>
                                <div class="upcoming-game-title">${game.title}</div>
                                ${gameInfo}
                                <div class="upcoming-game-leaderboard" id="leaderboard-${game.game_id}">
                                    <div class="leaderboard-loading">Chargement des scores...</div>
                                </div>
                                <div class="upcoming-game-id">ID: ${game.game_id}</div>
                            </a>
                        </div>
                    `;
                }).join('');
                
                // Load leaderboards for each game
                for (const game of games) {
                    if (game.enable_score !== false && game.enable_score !== "false") {
                        await loadGameLeaderboard(game.game_id);
                    } else {
                        // Hide leaderboard for games with disabled scoring
                        const leaderboardElement = document.getElementById(`leaderboard-${game.game_id}`);
                        if (leaderboardElement) {
                            leaderboardElement.style.display = 'none';
                        }
                    }
                }
            }
        }

        async function loadGameLeaderboard(gameId) {
            const leaderboardElement = document.getElementById(`leaderboard-${gameId}`);
            if (!leaderboardElement) return;

            try {
                const scores = await fetchLeaderboardData(gameId);
                
                if (!scores || scores.length === 0) {
                    leaderboardElement.innerHTML = '<div class="leaderboard-empty">Aucun score</div>';
                    return;
                }

                let leaderboardHTML = '<div class="leaderboard-title">üèÜ Top scores</div>';
                scores.forEach((score, index) => {
                    const rankEmoji = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : 'ü•â';
                    leaderboardHTML += `
                        <div class="leaderboard-entry">
                            <span class="leaderboard-rank">${rankEmoji}</span>
                            <span class="leaderboard-player">${score.player}</span>
                            <span class="leaderboard-score">${score.score.toLocaleString()}</span>
                        </div>
                    `;
                });
                
                leaderboardElement.innerHTML = leaderboardHTML;
            } catch (error) {
                console.error('Error loading leaderboard for', gameId, ':', error);
                leaderboardElement.innerHTML = '<div class="leaderboard-error">Erreur de chargement</div>';
            }
        }

        function formatWeek(weekString) {
            const year = weekString.substring(0, 4);
            const week = weekString.substring(4, 6);
            return `${week}/${year}`;
        }

        function getThumbnailSrc(coverArt) {
            if (!coverArt || coverArt === '/assets/images/placeholder_thumb.png') {
                return '/assets/images/placeholder_thumb.png';
            }
            
            // Convert cover.png to cover_thumb.png
            if (coverArt.includes('/cover.png')) {
                return coverArt.replace('/cover.png', '/cover_thumb.png');
            }
            
            return coverArt;
        }

        function getGameInfo(game) {
            let info = '';
            if (game.developer || game.year || game.genre) {
                info = '<div class="upcoming-game-info">';
                if (game.developer) info += `<span class="developer">${game.developer}</span>`;
                if (game.year) info += `<span class="year">${game.year}</span>`;
                if (game.genre) info += `<span class="genre">${game.genre}</span>`;
                info += '</div>';
            }
            return info;
        }

        function handleGameClick(element) {
            // Simple click handler for game cards
            const link = element.querySelector('a');
            if (link) {
                window.location.href = link.href;
            }
        }

        function showError() {
            const loadingMessage = document.getElementById('loading-message');
            const errorMessage = document.getElementById('error-message');
            
            loadingMessage.style.display = 'none';
            errorMessage.style.display = 'block';
        }

        // Initialize meta tags with current domain
        document.addEventListener('DOMContentLoaded', function() {
            const currentDomain = window.location.origin;
            const currentUrl = window.location.href;
            
            // Update Open Graph meta tags
            updateMetaTag('og:url', currentUrl);
            updateMetaTag('og:image', `${currentDomain}/assets/images/bonjourarcade-logo.png`);
            
            // Update Twitter meta tags
            updateMetaTag('twitter:url', currentUrl);
            updateMetaTag('twitter:image', `${currentDomain}/assets/images/bonjourarcade-logo.png`);
            
            // Load upcoming games
            loadUpcomingGames();
        });
        
        /**
         * Helper function to update meta tags
         * @param {string} property - The meta tag property to update
         * @param {string} content - The new content value
         */
        function updateMetaTag(property, content) {
            const metaTag = document.querySelector(`meta[property="${property}"]`) || 
                           document.querySelector(`meta[name="${property}"]`);
            if (metaTag) {
                metaTag.setAttribute('content', content);
            }
        }
    </script>
</body>
</html>
